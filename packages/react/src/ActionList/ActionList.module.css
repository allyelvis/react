/* stylelint-disable selector-max-compound-selectors */
/* stylelint-disable selector-max-specificity */
/* stylelint-disable max-nesting-depth */

/* check this as full width variant */
.ActionListHeader {
  margin-bottom: var(--base-size-16);
  margin-left: var(--base-size-8);
}

.GroupHeadingWrap {
  display: flex;
  font-size: var(--text-body-size-small);
  font-weight: var(--base-text-weight-semibold);
  line-height: var(--text-body-lineHeight-small);
  color: var(--fgColor-muted);
  flex-direction: column;
  /* stylelint-disable-next-line primer/spacing */
  padding-inline: var(--control-medium-paddingBlock);
  padding-block: var(--base-size-8);

  &:where([data-variant='filled']) {
    /* stylelint-disable-next-line primer/spacing */
    margin-block-start: calc(var(--base-size-8) - var(--borderWidth-thin));
    margin-block-end: var(--base-size-8);
    margin-inline: calc(-1 * var(--base-size-8));
    background: var(--bgColor-muted);
    border-top: solid var(--borderWidth-thin) var(--borderColor-muted);
    border-bottom: solid var(--borderWidth-thin) var(--borderColor-muted);

    /* if no children, treat as divider */
    &:empty {
      height: var(--base-size-8);
      box-sizing: border-box;
    }

    &:first-child {
      margin-block-start: 0;
    }
  }
}

.GroupHeading {
  margin: 0;
  font-size: var(--text-body-size-small);
  font-weight: var(--base-text-weight-semibold);
  color: var(--fgColor-muted);
  align-self: flex-start;
}

.ActionList {
  padding: 0;
  margin: 0;
  list-style: none;

  ul {
    padding: 0;
    margin: 0;
    list-style: none;
  }

  &:where([data-variant='inset']) {
    padding: var(--base-size-8);
  }

  &:where([data-dividers]) {
    & .ItemLabel::before {
      position: absolute;
      /* stylelint-disable-next-line primer/spacing */
      top: calc(-1 * var(--control-medium-paddingBlock));
      display: block;
      width: 100%;
      height: 1px;
      content: '';
      /* stylelint-disable-next-line primer/colors */
      background: var(--borderColor-muted);
    }

    /* if inline description, move pseudo divider to wrapper */
    & [data-description='inline'] {
      &::before {
        position: absolute;
        /* stylelint-disable-next-line primer/spacing */
        top: calc(-1 * var(--control-medium-paddingBlock));
        display: block;
        width: 100%;
        height: var(--borderWidth-thin);
        content: '';
        /* stylelint-disable-next-line primer/colors */
        background: var(--borderColor-muted);
      }

      /* unset the default label pseudo */
      & .ItemLabel::before {
        content: unset;
      }
    }

    /* hide if item is first of type with label::before, or is the first item after a sectionDivider */
    .ActionListItem:first-of-type .ItemLabel::before,
    .ActionList-sectionDivider + .ActionListItem .ItemLabel::before {
      visibility: hidden;
    }

    /* hide if item is first of type with label::before, or is the first item after a sectionDivider */
    .ActionListItem:first-of-type [data-description='inline']::before,
    .ActionList-sectionDivider + .ActionListItem [data-description='inline']::before {
      visibility: hidden;
    }
  }
}

/* list dividers */

.ActionListWrap--divided {
  /* hide divider if item is active */
  & [data-active] {
    & .ItemLabel::before,
    & + .ActionListItem .ItemLabel::before {
      visibility: hidden;
    }
  }
}

/* ActionList::Item */

.ActionListItem {
  position: relative;
  list-style: none;
  background-color: var(--control-transparent-bgColor-rest);
  border-radius: var(--borderRadius-medium);

  /* state */

  &:hover,
  &:active {
    cursor: pointer;
  }

  /* hide dividers  */
  @media (hover: hover) {
    &:hover {
      & .ItemLabel::before,
      & + .ActionListItem .ItemLabel::before {
        visibility: hidden;
      }

      & [data-description='inline']::before,
      & + .ActionListItem [data-description='inline']::before {
        visibility: hidden;
      }
    }
  }

  /* Make sure that the first visible item isn't a divider */
  &[hidden] + .ActionList-sectionDivider {
    display: none;
  }

  /* collapse styles here */
  &.ActionListItem--hasSubItem {
    /* first child */
    & > .ActionListContent {
      z-index: 1;

      @media (hover: hover) {
        &:hover {
          background-color: var(--control-transparent-bgColor-hover);
        }
      }

      &:active {
        background-color: var(--control-transparent-bgColor-active);
      }
    }
  }

  /* only hover li without list as children */
  &:not(.ActionListItem--hasSubItem),
   /* target contents of first child li if sub-item (li wraps item label + nested ul) */
  &.ActionListItem--hasSubItem > .ActionListContent {
    @media (hover: hover) {
      &:hover {
        cursor: pointer;
        background-color: var(--control-transparent-bgColor-hover);
        background-color: pink;

        &:not([data-active], :focus-visible) {
          /* Support for "Windows high contrast mode" */
          outline: solid var(--borderWidth-thin) transparent;
          outline-offset: calc(-1 * var(--borderWidth-thin));
          box-shadow: var(--boxShadow-thin) var(--control-transparent-borderColor-active);
        }
      }
    }

    &:active {
      background: var(--control-transparent-bgColor-active);

      &:not([data-active]) {
        /* Support for "Windows high contrast mode" https:sarahmhigley.com/writing/whcm-quick-tips/ */
        outline: solid var(--borderWidth-thin) transparent;
        outline-offset: calc(-1 * var(--borderWidth-thin));
        box-shadow: var(--boxShadow-thin) var(--control-transparent-borderColor-active);
      }

      & .ItemLabel::before,
      & + .ActionListItem .ItemLabel::before {
        visibility: hidden;
      }
    }
  }

  /* Autocomplete [aria-selected] items */

  /* &[aria-selected='true'] {
    font-weight: var(--base-text-weight-normal);
    background: var(--control-transparent-bgColor-selected);

    @media (hover: hover) {
      &:hover {
        background-color: var(--control-transparent-bgColor-hover);
      }
    }

    &::before,
    & + .ActionListItem::before {
      visibility: hidden;
    } */

  /* blue accent line */

  /* &::after {
    }
  } */

  /* active state [aria-current] */

  &[data-active] {
    /* provides a visual indication of the current item for Windows high-contrast mode */
    outline: 2px solid transparent;

    &:not(.ActionListItem--subItem) {
      & .ItemLabel {
        font-weight: var(--base-text-weight-semibold);
      }
    }

    &:not([data-variant='danger']) {
      background: var(--control-transparent-bgColor-selected);

      @media (hover: hover) {
        &:hover {
          background-color: var(--control-transparent-bgColor-hover);
        }
      }

      &::before,
      & + .ActionListItem::before {
        visibility: hidden;
      }

      /* blue accent line  */
      &::after {
        position: absolute;
        top: calc(50% - var(--base-size-12));
        left: calc(-1 * var(--base-size-8));
        width: var(--base-size-4);
        height: var(--base-size-24);
        content: '';
        background: var(--bgColor-accent-emphasis);
        border-radius: var(--borderRadius-medium);
      }
    }
  }

  /* disabled */

  &[aria-disabled='true'] {
    & .ActionListContent {
      & .ItemLabel,
      & .Description,
      & .VisualWrap {
        color: var(--control-fgColor-disabled);
        color: red;
      }
    }

    &:hover {
      & .ActionListContent {
        cursor: not-allowed;
        background-color: transparent;
      }
    }
  }

  /* variants */

  /* danger */
  &[data-variant='danger'] {
    & .ItemLabel {
      color: var(--control-danger-fgColor-rest);
    }

    & .VisualWrap {
      color: var(--control-danger-fgColor-rest);
    }

    @media (hover: hover) {
      &:hover {
        background: var(--control-danger-bgColor-hover);

        & .ItemLabel,
        & .VisualWrap,
        & .Description {
          color: var(--control-danger-fgColor-hover);
        }
      }
    }

    & .ActionListContent {
      &:active {
        background: var(--control-danger-bgColor-active);

        & .ItemLabel,
        & .VisualWrap,
        & .Description {
          color: var(--control-danger-fgColor-hover);
        }
      }
    }
  }

  /*
  * checkbox item [aria-checked]
  * listbox [aria-selected]
  */

  & .MultiSelectCheckbox {
    position: relative;
    display: grid;
    width: var(--base-size-16);
    height: var(--base-size-16);
    margin: 0;
    margin-top: var(--base-size-2); /* 2px to center align with label (20px line-height) */
    cursor: pointer;
    background-color: var(--bgColor-default);
    border: var(--borderWidth-thin) solid var(--control-borderColor-emphasis);
    border-radius: var(--borderRadius-small);
    transition:
      background-color,
      border-color 80ms cubic-bezier(0.33, 1, 0.68, 1); /* checked -> unchecked - add 120ms delay to fully see animation-out */

    place-content: center;

    &::before {
      width: var(--base-size-16);
      height: var(--base-size-16);
      content: '';
      /* stylelint-disable-next-line primer/colors */
      background-color: var(--control-checked-fgColor-rest);
      transition: visibility 0s linear 230ms;
      clip-path: inset(var(--base-size-16) 0 0 0);

      /* octicon checkmark image */
      mask-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOSIgdmlld0JveD0iMCAwIDEyIDkiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTEuNzgwMyAwLjIxOTYyNUMxMS45MjEgMC4zNjA0MjcgMTIgMC41NTEzMDUgMTIgMC43NTAzMTNDMTIgMC45NDkzMjEgMTEuOTIxIDEuMTQwMTkgMTEuNzgwMyAxLjI4MUw0LjUxODYgOC41NDA0MkM0LjM3Nzc1IDguNjgxIDQuMTg2ODIgOC43NiAzLjk4Nzc0IDguNzZDMy43ODg2NyA4Ljc2IDMuNTk3NzMgOC42ODEgMy40NTY4OSA4LjU0MDQyTDAuMjAxNjIyIDUuMjg2MkMwLjA2ODkyNzcgNS4xNDM4MyAtMC4wMDMzMDkwNSA0Ljk1NTU1IDAuMDAwMTE2NDkzIDQuNzYwOThDMC4wMDM1NTIwNSA0LjU2NjQzIDAuMDgyMzg5NCA0LjM4MDgxIDAuMjIwMDMyIDQuMjQzMjFDMC4zNTc2NjUgNC4xMDU2MiAwLjU0MzM1NSA0LjAyNjgxIDAuNzM3OTcgNC4wMjMzOEMwLjkzMjU4NCA0LjAxOTk0IDEuMTIwOTMgNC4wOTIxNyAxLjI2MzM0IDQuMjI0ODJMMy45ODc3NCA2Ljk0ODM1TDEwLjcxODYgMC4yMTk2MjVDMTAuODU5NSAwLjA3ODk5MjMgMTEuMDUwNCAwIDExLjI0OTUgMEMxMS40NDg1IDAgMTEuNjM5NSAwLjA3ODk5MjMgMTEuNzgwMyAwLjIxOTYyNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=');
      mask-size: 75%;
      mask-repeat: no-repeat;
      mask-position: center;
      animation: checkmarkOut 80ms cubic-bezier(0.65, 0, 0.35, 1); /*  forwards;  slightly snappier animation out */
    }
  }

  &[aria-checked='true'],
  &[aria-selected='true'] {
    & .MultiSelectCheckbox {
      background-color: var(--control-checked-bgColor-rest);
      border-color: var(--control-checked-borderColor-rest);
      transition:
        background-color,
        border-color 80ms cubic-bezier(0.32, 0, 0.67, 0) 0ms; /* unchecked -> checked */

      &::before {
        visibility: visible;
        transition: visibility 0s linear 0s;
        animation: checkmarkIn 80ms cubic-bezier(0.65, 0, 0.35, 1) forwards 80ms;
      }
    }

    & .SingleSelectCheckmark {
      visibility: visible;
    }
  }

  &[aria-checked='false'],
  &[aria-selected='false'] {
    & .MultiSelectCheckbox {
      &::before {
        visibility: hidden;
      }
    }

    & .SingleSelectCheckmark {
      visibility: hidden;
    }
  }
}

/* button or a tag */
.ActionListContent {
  position: relative;
  display: grid;
  width: 100%;
  /* stylelint-disable-next-line primer/spacing */
  padding-block: var(--control-medium-paddingBlock);
  /* stylelint-disable-next-line primer/spacing */
  padding-inline: var(--control-medium-paddingInline-condensed);
  color: var(--control-fgColor-rest);
  text-align: left;
  user-select: none;
  background-color: transparent;
  border: none;
  border-radius: var(--borderRadius-medium);
  transition: background 33.333ms linear;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  grid-template-rows: min-content;
  grid-template-areas: 'leadingAction leadingVisual label trailingVisual trailingAction';
  grid-template-columns: min-content min-content minmax(0, auto) min-content min-content;
  align-items: start;

  /* column-gap persists with empty grid-areas, margin applies only when children exist */
  & > :not(:last-child) {
    /* stylelint-disable-next-line primer/spacing */
    margin-right: var(--control-medium-gap);
  }

  /* state */

  &:hover {
    text-decoration: none;
  }

  /* collapsible item [aria-expanded] */

  /* nesting (single level)
   target items inside expanded subgroups */
  &[aria-expanded] {
    & + .ActionList--subGroup {
      @media screen and (prefers-reduced-motion: no-preference) {
        transition:
          opacity 160ms cubic-bezier(0.25, 1, 0.5, 1),
          transform 160ms cubic-bezier(0.25, 1, 0.5, 1);
      }

      & .ActionListContent {
        padding-left: var(--base-size-24);
      }
    }

    /* has 16px leading visual */
    &.ActionListContent--visual16 + .ActionList--subGroup {
      & .ActionListContent {
        padding-left: var(--base-size-32);
      }
    }

    /* has 20px leading visual */
    &.ActionListContent--visual20 + .ActionList--subGroup {
      & .ActionListContent {
        padding-left: var(--base-size-36);
      }
    }

    /* has 24px leading visual */
    &.ActionListContent--visual24 + .ActionList--subGroup {
      & .ActionListContent {
        padding-left: var(--base-size-40);
      }
    }
  }

  &[aria-expanded='true'] {
    & .ActionListItem-collapseIcon {
      transition: transform 120ms linear;
      transform: scaleY(-1);
    }

    & + .ActionList--subGroup {
      height: auto;
      overflow: visible;
      visibility: visible;
      opacity: 1;
      transform: translateY(0);
    }

    &.ActionListContent--hasActiveSubItem {
      & > .ItemLabel {
        font-weight: var(--base-text-weight-semibold);
      }
    }
  }

  &[aria-expanded='false'] {
    & .ActionListItem-collapseIcon {
      transition: transform 120ms linear;
      transform: scaleY(1);
    }

    & + .ActionList--subGroup {
      height: 0;
      overflow: hidden;
      visibility: hidden;
      opacity: 0;
      transform: translateY(calc(-1 * var(--base-size-16)));
    }

    /* show active indicator on parent collapse if child is active */
    &.ActionListContent--hasActiveSubItem {
      background: var(--control-transparent-bgColor-selected);

      & .ItemLabel {
        font-weight: var(--base-text-weight-semibold);
      }

      &::before,
      & + .ActionListItem::before {
        visibility: hidden;
      }

      /* blue accent line */
      &::after {
        /* @mixin activeIndicatorLine; */
      }
    }
  }

  &.ActionListContent--blockDescription {
    /* if leading/trailing visual, align with first line of content */
    & .VisualWrap {
      place-self: start;
    }
  }
}

/* place children on grid */

.LeadingAction {
  grid-area: leadingAction;
}

.LeadingVisual {
  grid-area: leadingVisual;
}

.TrailingVisual {
  grid-area: trailingVisual;
}

.TrailingAction {
  grid-area: trailingAction;
}

/* wrapper span
 default block */
.ItemDescriptionWrap {
  grid-area: label;
  display: flex;
  flex-direction: column;
  gap: var(--base-size-4);

  & .ItemLabel {
    font-weight: var(--base-text-weight-semibold);
  }
}

/* inline */
[data-description='inline'] {
  position: relative;
  flex-direction: row;
  align-items: baseline;
  gap: var(--base-size-8);
}

/* description */
.Description {
  font-size: var(--text-body-size-small);
  font-weight: var(--base-text-weight-normal);
  line-height: var(--text-body-lineHeight-small);
  color: var(--fgColor-muted);
}

/* helper for grid alignment with multi-line content
 span wrapping svg or text */
.VisualWrap {
  display: flex;
  min-height: var(--control-medium-lineBoxHeight);
  color: var(--fgColor-muted);
  pointer-events: none;
  fill: var(--fgColor-muted);
  align-items: center;
}

/* text */
.ItemLabel {
  position: relative;
  font-size: var(--text-body-size-medium);
  font-weight: var(--base-text-weight-normal);
  line-height: var(--text-body-lineHeight-medium);
  color: var(--fgColor-default);
  grid-area: label;
}

.ItemLabel--truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* nested lists (only supports 1 level currently)
 target ActionListItem--subItem for padding-left to maintain :active :after state */

.ActionListItem--subItem > .ActionListContent > .ItemLabel {
  font-size: var(--text-body-size-small);
  line-height: var(--text-body-lineHeight-small);
}

/* trailing action icon button */

.ActionListItem--withActions {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
}

.ActionListItem-trailingAction {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

/* show trailing action button on hover */

.ActionListItem--trailingActionHover {
  & .ActionListItem-trailingAction {
    visibility: hidden;
  }

  &:hover,
  &:focus-within {
    & .ActionListItem-trailingAction {
      visibility: visible;
    }
  }
}

/* ActionList::Divider */

.ActionList-sectionDivider {
  /* no children */
  &:empty {
    display: block;
    height: var(--borderWidth-thin);
    padding: 0;
    /* stylelint-disable-next-line primer/spacing */
    margin-block-start: calc(var(--base-size-8) - var(--borderWidth-thin));
    margin-block-end: var(--base-size-8);
    margin-inline: calc(-1 * var(--base-size-8));
    list-style: none;
    /* stylelint-disable-next-line primer/colors */
    background: var(--borderColor-muted);
    border: 0;
  }
}

.WhatIsThis {
  display: flex;
  padding: 0;
  font: inherit;
  color: inherit;
  cursor: pointer;
  background: none;
  border: none;
}

@keyframes checkmarkIn {
  from {
    clip-path: inset(var(--base-size-16) 0 0 0);
  }

  to {
    clip-path: inset(0 0 0 0);
  }
}

@keyframes checkmarkOut {
  from {
    clip-path: inset(0 0 0 0);
  }

  to {
    clip-path: inset(var(--base-size-16) 0 0 0);
  }
}
